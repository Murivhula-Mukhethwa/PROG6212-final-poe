@model List<CMCS.web2.Models.Claim>
@{
    ViewData["Title"] = "My Claims";
    var sortBy = ViewBag.SortBy as string ?? "submitted";
    var sortOrder = ViewBag.SortOrder as string ?? "desc";
}

<div class="row">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0"><i class="fas fa-list-alt me-2"></i>My Claims</h4>
                <a href="@Url.Action("Create", "Claim")" class="btn btn-light btn-sm">
                    <i class="fas fa-plus me-1"></i>New Claim
                </a>
            </div>
            <div class="card-body">
                @if (!Model.Any())
                {
                    <div class="text-center py-4">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <h5>No claims found</h5>
                        <p class="text-muted">You haven't submitted any claims yet.</p>
                        <a href="@Url.Action("Create", "Claim")" class="btn btn-primary">Submit Your First Claim</a>
                    </div>
                }
                else
                {
                    <!-- Sorting Controls -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p class="text-muted mb-0">Showing @Model.Count claims</p>
                        </div>
                        <div class="col-md-6 text-end">
                            <div class="btn-group btn-group-sm">
                                <a href="@Url.Action("MyClaims", "Claim", new { sortBy = "submitted", sortOrder = sortOrder == "asc" ? "desc" : "asc" })"
                                   class="btn @(sortBy == "submitted" ? "btn-primary" : "btn-outline-primary")">
                                    Date @(sortBy == "submitted" ? (sortOrder == "asc" ? "↑" : "↓") : "")
                                </a>
                                <a href="@Url.Action("MyClaims", "Claim", new { sortBy = "status", sortOrder = sortOrder == "asc" ? "desc" : "asc" })"
                                   class="btn @(sortBy == "status" ? "btn-primary" : "btn-outline-primary")">
                                    Status @(sortBy == "status" ? (sortOrder == "asc" ? "↑" : "↓") : "")
                                </a>
                                <a href="@Url.Action("MyClaims", "Claim", new { sortBy = "amount", sortOrder = sortOrder == "asc" ? "desc" : "asc" })"
                                   class="btn @(sortBy == "amount" ? "btn-primary" : "btn-outline-primary")">
                                    Amount @(sortBy == "amount" ? (sortOrder == "asc" ? "↑" : "↓") : "")
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Submitted Date</th>
                                    <th>Hours</th>
                                    <th>Rate</th>
                                    <th>Total Amount</th>
                                    <th>Status</th>
                                    <th>Document</th>
                                    <th>Last Updated</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var claim in Model)
                                {
                                    <tr>
                                        <td>@claim.SubmittedDate.ToString("dd/MM/yyyy HH:mm")</td>
                                        <td>@claim.HoursWorked</td>
                                        <td>€@claim.HourlyRate.ToString("N2")</td>
                                        <td><strong>€@claim.TotalAmount.ToString("N2")</strong></td>
                                        <td>
                                            <span class="badge @GetStatusBadgeClass(claim.Status) status-badge">
                                                @claim.Status
                                            </span>
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(claim.StoredFileName))
                                            {
                                                <a href="@Url.Action("Download", "Claim", new { id = claim.ClaimId })"
                                                   class="btn btn-outline-primary btn-sm">
                                                    <i class="fas fa-download me-1"></i>Download
                                                </a>
                                            }
                                            else
                                            {
                                                <span class="text-muted">No document</span>
                                            }
                                        </td>
                                        <td>
                                            @if (claim.LastUpdated.HasValue)
                                            {
                                                <small>@claim.LastUpdated.Value.ToString("dd/MM/yyyy HH:mm")</small>
                                                <br>
                                                <small class="text-muted">by @claim.LastUpdatedBy</small>
                                            }
                                            else
                                            {
                                                <span class="text-muted">-</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetStatusBadgeClass(CMCS.web2.Models.ClaimStatus status)
    {
        return status switch
        {
            CMCS.web2.Models.ClaimStatus.Pending => "bg-warning",
            CMCS.web2.Models.ClaimStatus.Verified => "bg-info",
            CMCS.web2.Models.ClaimStatus.Approved => "bg-success",
            CMCS.web2.Models.ClaimStatus.Rejected => "bg-danger",
            _ => "bg-secondary",
        };
    }
}